<div class="example-container">
<div class="flex flex-wrap gap-2 items-center justify-start mt-4 mb-4">
    <button mat-stroked-button color="primary" routerLink="/signal-forms">Go to List</button>
    <button mat-stroked-button color="primary" routerLink="/signal-forms/example4">Prev</button>
    <button mat-stroked-button color="primary" routerLink="/signal-forms/example6">Next</button>
  </div>

  <mat-tab-group>
    <mat-tab label="Demo">
      <div class="content-area">
        <h2>Example 5: Advanced Nested Signal Form</h2>
        <p>This example demonstrates a deeply nested form with multiple fields and arrays, including dynamic tags for each contact.</p>
      </div>
      <div class="demo-section flex gap-4 flex-col">
        <mat-card class="w-full">
          <mat-card-content>
            <form (ngSubmit)="onSubmit()">
              <!-- User fields -->
              <div>
                <input placeholder="Name" [control]="userForm.name" />
                @if(userForm.name().touched() || userForm.name().dirty()) {
                  @for (err of userForm.name().errors(); track err.kind) {
                    <p style="color:red">{{ err.message }}</p>
                  }
                }
              </div>
              <div>
                <input placeholder="Age" type="number" [control]="userForm.age" />
                @if(userForm.age().touched() || userForm.age().dirty()) {
                  @for (err of userForm.age().errors(); track err.kind) {
                    <p style="color:red">{{ err.message }}</p>
                  }
                }
              </div>
              <div>
                <input placeholder="Email" [control]="userForm.email" />
                @if(userForm.email().touched() || userForm.email().dirty()) {
                  @for (err of userForm.email().errors(); track err.kind) {
                    <p style="color:red">{{ err.message }}</p>
                  }
                }
              </div>

              <!-- Additional user fields -->
              <div>
                <label>Gender:</label>
                <div class="flex gap-2 items-center mb-2">
                  <label><input type="radio" [control]="userForm.gender" value="male" /> Male</label>
                  <label><input type="radio" [control]="userForm.gender" value="female" /> Female</label>
                  <label><input type="radio" [control]="userForm.gender" value="other" /> Other</label>
                </div>
                @if(userForm.gender().touched() || userForm.gender().dirty()) {
                  @for (err of userForm.gender().errors(); track err.kind) {
                    <p style="color:red">{{ err.message }}</p>
                  }
                }
              </div>
              <div>
                <label>
                    <input type="checkbox" [control]="userForm.subscribe" /> Subscribe to newsletter:
                </label>
              </div>

              <!-- Address fields -->
              <div>
                <h3>Address</h3>
                <div class="flex gap-2 mb-4">
                    <div>
                        <input placeholder="Street" [control]="userForm.address.street" />
                        @if(userForm.address.street().touched() || userForm.address.street().dirty()) {
                            @for (err of userForm.address.street().errors(); track err.kind) {
                                <p style="color:red">{{ err.message }}</p>
                            }
                        }
                    </div>
                    <div>
                        <input placeholder="City" [control]="userForm.address.city" />
                        @if(userForm.address.city().touched() || userForm.address.city().dirty()) {
                            @for (err of userForm.address.city().errors(); track err.kind) {
                                <p style="color:red">{{ err.message }}</p>
                            }
                        }
                    </div>
                    <div>
                        <input placeholder="Zip" [control]="userForm.address.zip" />
                        @if(userForm.address.zip().touched() || userForm.address.zip().dirty()) {
                            @for (err of userForm.address.zip().errors(); track err.kind) {
                                <p style="color:red">{{ err.message }}</p>
                            }
                        }
                    </div>
                    <div>
                        <select [control]="userForm.address.country">
                            <option value="">Select Country</option>
                            <option value="India">India</option>
                            <option value="USA">USA</option>
                            <option value="UK">UK</option>
                            <option value="Other">Other</option>
                        </select>
                        @if(userForm.address.country().touched() || userForm.address.country().dirty()) {
                            @for (err of userForm.address.country().errors(); track err.kind) {
                                <p style="color:red">{{ err.message }}</p>
                            }
                        }
                </div>
                </div>
              </div>

              <!-- Contacts array -->
              <div>
                <h3>Contacts</h3>
                @for (contact of userForm.address.contacts; track contact; let i = $index) {
                  <div class="contact-card">
                    <div class="flex gap-2 items-center mb-2">
                      <div>
                        <input [control]="contact.type" placeholder="Type (e.g. phone, email)" />
                        @if(contact.type().touched() || contact.type().dirty()) {
                          @for (err of contact.type().errors(); track err.kind) {
                            <p style="color:red">{{ err.message }}</p>
                          }
                        }
                      </div>
                      <div>
                        <input [control]="contact.value" placeholder="Value" />
                        @if(contact.value().touched() || contact.value().dirty()) {
                          @for (err of contact.value().errors(); track err.kind) {
                            <p style="color:red">{{ err.message }}</p>
                          }
                        }
                      </div>
                      <button mat-flat-button color="warn" type="button" (click)="removeContact(i)">Remove Contact</button>
                    </div>
                    <!-- Tags array for each contact -->
                    <div class="ml-6">
                      <h4>Tags</h4>
                      @for (tag of contact.tags; track tag; let j = $index) {
                        <div class="flex gap-2 items-center mb-2">
                          <input [control]="tag" placeholder="Tag" />
                          <button mat-flat-button color="warn" type="button" (click)="removeTag(i, j)">Remove Tag</button>
                        </div>
                        
                        @if(tag().touched() || tag().dirty()) {
                          @for (err of tag().errors(); track err.kind) {
                            <p style="color:red">{{ err.message }}</p>
                          }
                        }
                      }
                      @empty {
                        <p class="text-gray-500 py-2">No tags added yet.</p>
                      }
                      <button mat-flat-button color="primary" type="button" (click)="addTag(i)">+ Add Tag</button>
                    </div>
                  </div>
                }
                @empty {
                  <p class="text-gray-500 py-2">No contacts added yet.</p>
                }
                <button mat-flat-button color="primary" type="button" (click)="addContact()">+ Add Contact</button>
              </div>

              <div>
                <button mat-stroked-button color="primary" type="submit" [disabled]="!userForm().valid">Save</button>
              </div>
            </form>
          </mat-card-content>
        </mat-card>
        <mat-card class="w-full">
          <mat-card-content>
            <pre>{{ user() | json }}</pre>
            <h3>Key Features</h3>
            <ul>
              <li>‚ö° Deeply nested reactive form state powered by Angular signals</li>
              <li>‚úÖ Schema-based validation for all fields (user, address, contacts, tags)</li>
              <li>üîÑ Real-time error feedback and UI updates</li>
              <li>‚ûï Dynamic add/remove for contacts and tags</li>
              <li>üß© Minimal, readable, and extensible form logic</li>
              <li>üõ°Ô∏è Instant validation and error display for each field</li>
            </ul>
            <p>This example demonstrates efficient nested form state management and custom validation using Angular signals, with instant error feedback and a clean, extensible approach.</p>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>
    <mat-tab label="HTML">
      <markdown clipboard [src]="'assets/examples/signal-forms/example5/example5.component.html.md'"></markdown>
    </mat-tab>
    <mat-tab label="TS">
      <markdown clipboard [src]="'assets/examples/signal-forms/example5/example5.component.ts.md'"></markdown>
    </mat-tab>
    <mat-tab label="SCSS">
      <markdown clipboard [src]="'assets/examples/signal-forms/example5/example5.component.scss.md'"></markdown>
    </mat-tab>
  </mat-tab-group>
</div>
